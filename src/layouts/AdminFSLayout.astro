---
import { getLangFromCookie } from '../lib/i18n';

interface Props {
	title?: string;
	showHeader?: boolean;
}

const { title = 'Admin FashionStore', showHeader = true } = Astro.props;
const currentPath = Astro.url.pathname;
const rawLangCookie = Astro.cookies.get('fs_lang')?.value ?? null;
const lang = getLangFromCookie(rawLangCookie);
---

<!doctype html>
<html lang={lang}>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>{title}</title>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />
		<style is:global>
			* { margin: 0; padding: 0; box-sizing: border-box; }

			body {
				font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
				background: #fff;
				color: #111;
				line-height: 1.6;
				-webkit-font-smoothing: antialiased;
			}

			a { color: inherit; text-decoration: none; }
			button { font-family: inherit; }

			.container {
				width: 100%;
				max-width: 1200px;
				margin: 0 auto;
				padding: 0 1.5rem;
			}

			.container-sm { max-width: 520px; }

			.btn-primary {
				display: inline-flex;
				align-items: center;
				justify-content: center;
				padding: 0.875rem 2rem;
				background: #111;
				color: #fff;
				font-size: 0.8125rem;
				font-weight: 500;
				letter-spacing: 0.1em;
				text-transform: uppercase;
				border: 1px solid #111;
				cursor: pointer;
				transition: all 0.2s ease;
			}

			.btn-primary:hover { background: #333; border-color: #333; }
			.btn-primary:disabled { background: #d1d5db; border-color: #d1d5db; cursor: not-allowed; }

			.btn-secondary {
				display: inline-flex;
				align-items: center;
				justify-content: center;
				padding: 0.875rem 2rem;
				background: #fff;
				color: #111;
				font-size: 0.8125rem;
				font-weight: 500;
				letter-spacing: 0.1em;
				text-transform: uppercase;
				border: 1px solid #111;
				cursor: pointer;
				transition: all 0.2s ease;
			}

			.btn-secondary:hover { background: #f9fafb; }

			.btn-danger {
				display: inline-flex;
				align-items: center;
				justify-content: center;
				padding: 0.875rem 2rem;
				background: #fff;
				color: #991b1b;
				font-size: 0.8125rem;
				font-weight: 500;
				letter-spacing: 0.1em;
				text-transform: uppercase;
				border: 1px solid #991b1b;
				cursor: pointer;
				transition: all 0.2s ease;
			}

			.btn-danger:hover {
				background: #fef2f2;
			}

			.btn-link {
				display: inline-flex;
				align-items: center;
				background: none;
				border: none;
				color: #111;
				font-size: 0.8125rem;
				font-weight: 400;
				cursor: pointer;
				text-decoration: underline;
				text-underline-offset: 2px;
			}

			.form-input {
				width: 100%;
				padding: 0.875rem 1rem;
				font-size: 0.875rem;
				border: 1px solid #e5e7eb;
				background: #fff;
				transition: border-color 0.2s ease;
			}

			.form-input:focus { outline: none; border-color: #111; }

			.form-label {
				display: block;
				font-size: 0.75rem;
				font-weight: 500;
				letter-spacing: 0.05em;
				text-transform: uppercase;
				color: #6b7280;
				margin-bottom: 0.5rem;
			}

			.helper-text { font-size: 0.875rem; color: #6b7280; }

			.alert { padding: 1rem; font-size: 0.875rem; border: 1px solid; }
			.alert-error { background: #fef2f2; border-color: #fecaca; color: #991b1b; }
			.alert-success { background: #f0fdf4; border-color: #bbf7d0; color: #166534; }

			table { width: 100%; border-collapse: collapse; }
			th {
				text-align: left;
				padding: 0.75rem;
				border-bottom: 1px solid #e5e7eb;
				font-size: 0.6875rem;
				font-weight: 500;
				letter-spacing: 0.15em;
				text-transform: uppercase;
				color: #6b7280;
			}
			td { padding: 0.75rem; border-bottom: 1px solid #f3f4f6; font-size: 0.875rem; }
		</style>
	</head>
	<body>
		{showHeader && (
			<header style="border-bottom: 1px solid #e5e7eb;">
				<div class="container" style="display: flex; align-items: center; justify-content: space-between; gap: 1.5rem; height: 60px;">
					<a href="/admin-fs" style="font-size: 0.875rem; font-weight: 600; letter-spacing: 0.2em; text-transform: uppercase;">
						Fashion Store Admin
					</a>
					<nav style="display: flex; align-items: center; gap: 1.5rem; flex-wrap: wrap;">
						<a href="/admin-fs/productos" style={`font-size:0.75rem;letter-spacing:0.1em;text-transform:uppercase;${currentPath.startsWith('/admin-fs/productos') ? 'color:#111;' : 'color:#6b7280;'}`}>
							{lang === 'en' ? 'Products' : 'Productos'}
						</a>
						<a href="/admin-fs/pedidos" style={`font-size:0.75rem;letter-spacing:0.1em;text-transform:uppercase;${currentPath.startsWith('/admin-fs/pedidos') ? 'color:#111;' : 'color:#6b7280;'}`}>
							{lang === 'en' ? 'Orders' : 'Pedidos'}
						</a>
						<a href="/admin-fs/settings" style={`font-size:0.75rem;letter-spacing:0.1em;text-transform:uppercase;${currentPath === '/admin-fs/settings' ? 'color:#111;' : 'color:#6b7280;'}`}>
							{lang === 'en' ? 'Settings' : 'Ajustes'}
						</a>
						<a href="/admin-fs/ofertas" style={`font-size:0.75rem;letter-spacing:0.1em;text-transform:uppercase;${currentPath === '/admin-fs/ofertas' ? 'color:#111;' : 'color:#6b7280;'}`}>
							{lang === 'en' ? 'Offers' : 'Ofertas'}
						</a>
						<a href="/" style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; color: #6b7280;">
							{lang === 'en' ? 'Store' : 'Tienda'}
						</a>
						<button
							id="fs-admin-lang-toggle"
							type="button"
							data-current-lang={lang}
							class="btn-link"
							style="font-size: 0.75rem; letter-spacing: 0.12em; text-transform: uppercase;"
						>
							{lang === 'en' ? 'EN' : 'ES'}
						</button>
					</nav>
				</div>
			</header>
		)}

		<main>
			<slot />
		</main>

		<script>
			(() => {
				const btn = document.getElementById('fs-admin-lang-toggle');
				if (!(btn instanceof HTMLButtonElement)) return;

				const current = btn.dataset.currentLang === 'en' ? 'en' : 'es';
				const next = current === 'es' ? 'en' : 'es';

				btn.addEventListener('click', () => {
					try {
						document.cookie = `fs_lang=${encodeURIComponent(next)};path=/;max-age=31536000`;
					} catch {}
					try {
						window.localStorage.setItem('fs_lang', next);
					} catch {}
					window.location.reload();
				});
			})();
		</script>
	</body>
</html>
